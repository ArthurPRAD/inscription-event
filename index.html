<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Five ⚽ • Trapèze 1-2-2-2-2-1</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1626; --text:#e5e7eb; --muted:#9aa7bb;
      --accent:#22c55e; --danger:#ef4444; --warn:#f59e0b; --border:#23334b;
      --grass1:#0a5b2a; --grass2:#0d7135; --line:#d9f99d;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial; background:radial-gradient(1200px 700px at 70% -10%, #13233f 0%, #0b1020 45%, #090d15 100%); color:var(--text)}
    .wrap{max-width:1080px; margin:auto; padding:24px}

    .card{background:var(--panel); border:1px solid var(--border); border-radius:20px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 6px; font-size:28px}
    .sub{margin:0 0 12px; color:var(--muted); font-size:14px}

    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    label{display:block; font-weight:600; margin-bottom:6px}
    input, select{width:100%; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:12px; padding:12px 14px; outline:none}
    input:focus, select:focus{border-color:#3a506d}
    button{appearance:none; border:0; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer}
    .btn{background:var(--accent); color:#061f12}
    .btn-outline{background:transparent; color:var(--text); border:1px solid var(--border)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .msg{font-size:14px}
    .msg.ok{color:var(--accent)} .msg.err{color:var(--danger)}

    .grid{display:grid; gap:14px}
    .two{grid-template-columns:1fr 1fr}
    @media (max-width:820px){ .two{grid-template-columns:1fr} }

    .counter{padding:8px 10px; border:1px dashed #314760; border-radius:12px; color:var(--muted); font-size:14px}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#0b1220; color:var(--muted); font-size:13px}
    .ok{color:var(--accent)} .warn{color:var(--warn)} .full{color:var(--danger)}

    /* ===== Terrain en trapèze (perspective) ===== */
    .stage{margin-top:18px}
    .pitch-wrap{position:relative; width:100%; padding-top:68%; margin:28px auto; filter:drop-shadow(0 20px 50px rgba(0,0,0,.45))}
    .pitch{
      position:absolute; inset:0;
      /* Trapèze: haut étroit -> bas large */
      clip-path:polygon(28% 0%, 72% 0%, 100% 100%, 0% 100%);
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.06) 0 1px, transparent 1px 28px),
        linear-gradient(180deg, var(--grass2), var(--grass1));
      border:2px solid rgba(255,255,255,.12);
      border-radius:24px;
      overflow:hidden;
    }
    /* Lignes principales (centre + surfaces suggérées) */
    .pitch::before, .pitch::after{
      content:""; position:absolute; left:0; right:0; height:1px; background:var(--line); opacity:.55;
    }
    .pitch::before{ top:50%; transform:translateY(-50%); }
    .pitch::after{ top:22%; } /* pour le style */

    #slots{position:absolute; inset:0;}

    .slot{
      position:absolute; display:flex; align-items:center; justify-content:center;
      transform-origin:center; transition:transform .2s ease, box-shadow .2s ease;
    }
    .slot:hover{transform:translateY(-3px)}
    .tile, .placeholder{
      border-radius:14px; padding:8px 10px; width:100%; height:100%;
      display:flex; flex-direction:column; gap:6px; justify-content:center;
      background:#0f1626ee; border:1px solid #2a3b55; color:#e7eefc;
      box-shadow:0 10px 24px rgba(0,0,0,.35);
    }
    .placeholder{background:#0f162655; border:1px dashed #3a506d; color:#b9c7db; align-items:center; text-align:center}
    .ph-top{font-size:12px; letter-spacing:.04em}
    .ph-ico{font-size:20px; font-weight:900; opacity:.9}
    .card-title{margin:0; font-size:14px; font-weight:800}
    .card-mail{font-size:11px; color:#b3bfd1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .tag{font-size:11px; padding:4px 6px; border-radius:999px; border:1px solid #2a3b55; width:max-content; color:#9ac7ff}

    .foot{color:var(--muted); font-size:12px; margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Inscriptions Five ⚽</h1>
      <p class="sub">Disposition <b>1-2-2-2-2-1</b> sur un terrain en trapèze (perspective). 10 places max.</p>

      <div class="row" style="margin-bottom:12px">
        <div class="counter">
          <span id="remaining">10</span> place(s) restante(s) ·
          <span id="booked">0</span> inscrit(s)
        </div>
        <span class="pill"><span id="statusDot">●</span> <span id="statusText">Ouvert</span></span>
        <div class="row" style="margin-left:auto; gap:8px">
          <button class="btn-outline" id="exportCsvBtn">Exporter CSV</button>
          <button class="btn-outline" id="resetBtn" title="Réinitialiser la démo locale">Reset</button>
        </div>
      </div>

      <form id="signupForm" class="grid two" novalidate>
        <div>
          <label for="name">Nom & prénom</label>
          <input id="name" name="name" type="text" placeholder="Alex Dupont" required minlength="2" />
        </div>
        <div>
          <label for="email">E-mail</label>
          <input id="email" name="email" type="email" placeholder="alex@example.com" required />
        </div>
        <div>
          <label for="phone">Téléphone (optionnel)</label>
          <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="06 12 34 56 78" />
        </div>
        <div>
          <label for="position">Poste préféré</label>
          <select id="position" name="position">
            <option value="polyvalent">Polyvalent</option>
            <option value="gardien">Gardien</option>
            <option value="defense">Défense</option>
            <option value="milieu">Milieu</option>
            <option value="attaque">Attaque</option>
          </select>
        </div>
        <div class="row" style="grid-column:1/-1">
          <button class="btn" id="submitBtn" type="submit">S’inscrire</button>
          <span class="msg" id="formMsg"></span>
        </div>
      </form>
    </div>

    <div class="stage">
      <div class="pitch-wrap">
        <div class="pitch">
          <div id="slots" aria-live="polite"></div>
        </div>
      </div>
    </div>

    <p class="foot">Démo locale (localStorage). En prod, envoie chaque inscription à ton backend et applique la limite côté serveur.</p>
  </div>

  <script>
    // ======= Paramètres =======
    const CAPACITY = 10;
    const STORAGE_KEY = "five_trapeze_signup_v1";
    const LAYOUT = [1,2,2,2,2,1]; // 1-2-2-2-2-1 (du haut vers le bas)

    // Références UI
    const form = document.getElementById("signupForm");
    const formMsg = document.getElementById("formMsg");
    const submitBtn = document.getElementById("submitBtn");
    const remainingEl = document.getElementById("remaining");
    const bookedEl = document.getElementById("booked");
    const statusText = document.getElementById("statusText");
    const statusDot = document.getElementById("statusDot");
    const exportCsvBtn = document.getElementById("exportCsvBtn");
    const resetBtn = document.getElementById("resetBtn");
    const slotsRoot = document.getElementById("slots");

    // ======= Helpers =======
    const getList = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch(e){ return []; }
    };
    const setList = (arr) => localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    const isEmail = (e) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
    const labelPoste = (v)=>({polyvalent:"Polyvalent",gardien:"Gardien",defense:"Défense",milieu:"Milieu",attaque:"Attaque"}[v]||"Polyvalent");

    function toast(ok, msg){ formMsg.textContent = msg; formMsg.className = "msg " + (ok ? "ok" : "err"); }

    // ======= Calcul des positions dans un trapèze =======
    /**
     * On modélise le trapèze comme une interpolation linéaire entre
     * - largeur du haut = TOP_W (% de la largeur totale)
     * - largeur du bas  = 100%
     * Chaque rang a:
     *  - y% (distance verticale)
     *  - rowW% = largeur de rang
     *  - left% = marge gauche
     */
    const TOP_W = 44;     // largeur en % du rang le plus haut
    const ROW_Y = [6, 22, 38, 56, 74, 90]; // positions verticales (du haut vers le bas)
    function rowWidthAt(t){ // t in [0..1] du haut vers bas
      return TOP_W + (100 - TOP_W) * t;
    }
    function layoutSlots(){
      const out = []; // {left, top, w, h}
      const totalRows = LAYOUT.length;
      let globalIndex = 0;
      for (let r=0; r<totalRows; r++){
        const n = LAYOUT[r];
        const t = r/(totalRows-1);
        const rowY = ROW_Y[r] ?? (6 + t*84);
        const rowW = rowWidthAt(t);
        const leftEdge = (100 - rowW)/2;

        for (let k=0; k<n; k++){
          // Position horizontale: (n+1) espaces -> centré
          const frac = (k+1)/(n+1);
          const cx = leftEdge + frac * rowW;
          // Taille des cartes (perspective): petit en haut, grand en bas
          const baseW = 8;    // % minimal
          const extra = 6;    // % ajouté au bas
          const w = baseW + extra * t;
          const h = w * 1.25; // ratio carte ~3:4
          out.push({
            index: globalIndex++,
            left: cx - w/2,
            top: rowY - h/2,
            w, h, row:r
          });
        }
      }
      return out;
    }
    const SLOT_GEOM = layoutSlots(); // 10 objets

    // ======= UI =======
    function makePlaceholder(){
      const wrap = document.createElement("div");
      wrap.className = "placeholder";
      wrap.innerHTML = `<div class="ph-top">LIBRE</div><div class="ph-ico">⚽</div>`;
      return wrap;
    }
    function makeCard(data){
      const el = document.createElement("div");
      el.className = "tile";
      const t = document.createElement("h3");
      t.className = "card-title"; t.textContent = data.name;
      const m = document.createElement("div");
      m.className = "card-mail"; m.textContent = data.email;
      const tag = document.createElement("div");
      tag.className = "tag"; tag.textContent = labelPoste(data.position);
      el.appendChild(t); el.appendChild(m); el.appendChild(tag);
      return el;
    }

    function render(){
      const list = getList();
      const booked = Math.min(list.length, CAPACITY);
      const remaining = Math.max(CAPACITY - booked, 0);

      bookedEl.textContent = booked;
      remainingEl.textContent = remaining;
      submitBtn.disabled = booked >= CAPACITY;
      statusText.textContent = booked >= CAPACITY ? "Complet" : (remaining <= 2 ? "Quasi complet" : "Ouvert");
      statusText.className = booked >= CAPACITY ? "full" : (remaining <= 2 ? "warn" : "ok");
      statusDot.textContent = "●";

      // Slots
      slotsRoot.innerHTML = "";
      for (let i=0; i<CAPACITY; i++){
        const g = SLOT_GEOM[i];
        const slot = document.createElement("div");
        slot.className = "slot";
        slot.style.left = g.left + "%";
        slot.style.top = g.top + "%";
        slot.style.width = g.w + "%";
        slot.style.height = g.h + "%";
        slot.style.transform = `translateZ(0)`;

        const signup = list[i];
        slot.appendChild(signup ? makeCard(signup) : makePlaceholder());
        slotsRoot.appendChild(slot);
      }
    }

    // ======= Soumission =======
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const name = String(fd.get("name")||"").trim();
      const email = String(fd.get("email")||"").trim().toLowerCase();
      const phone = String(fd.get("phone")||"").trim();
      const position = String(fd.get("position")||"polyvalent");

      if (name.length < 2) return toast(false, "Merci d’indiquer votre nom.");
      if (!isEmail(email)) return toast(false, "E-mail invalide.");

      const list = getList();
      if (list.length >= CAPACITY) return toast(false, "Désolé, c’est complet.");
      if (list.some(s => s.email === email)) return toast(false, "Cet e-mail est déjà inscrit.");

      const signup = { name, email, phone, position, ts: Date.now() };
      list.push(signup);
      setList(list);
      form.reset();
      toast(true, "Inscription confirmée !");
      render();

      // Exemple d'envoi backend (adapter l'URL puis décommenter)
      /*
      fetch("https://ton-endpoint.exemple/inscriptions", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(signup)
      }).catch(()=>{});
      */
    });

    // ======= Export / Reset =======
    exportCsvBtn.addEventListener("click", () => {
      const rows = [["Nom","Email","Téléphone","Poste","Rang","Horodatage"]];
      const list = getList();
      list.forEach((s, idx) => {
        const rang = SLOT_GEOM[idx]?.row ?? "";
        rows.push([s.name, s.email, s.phone || "", labelPoste(s.position), rang+1, new Date(s.ts).toISOString()]);
      });
      const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(",")).join("\n");
      const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "inscrits_five.csv"; a.click();
      URL.revokeObjectURL(url);
    });

    resetBtn.addEventListener("click", () => {
      if (confirm("Réinitialiser la liste locale des inscrits ?")){
        localStorage.removeItem(STORAGE_KEY);
        render();
        toast(true, "Liste réinitialisée.");
      }
    });

    // ======= Init =======
    render();
  </script>
</body>
</html>
